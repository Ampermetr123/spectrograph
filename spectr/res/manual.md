# Руководство пользователя

- [Руководство пользователя](#руководство-пользователя)
  - [Введение](#введение)
  - [Требования к аппаратному обеспечению](#требования-к-аппаратному-обеспечению)
  - [Установка программы](#установка-программы)
  - [Запуск программы и возможные ошибки](#запуск-программы-и-возможные-ошибки)
  - [Настройка программы](#настройка-программы)
  - [Окна программы](#окна-программы)
  - [Настройка обработки спектра](#настройка-обработки-спектра)
  - [Анализ спектра](#анализ-спектра)

## Введение
Программа предназначена для построения спектра по видеоизображению, получаемого от камеры в макете спектрографа.

## Требования к аппаратному обеспечению

- операционая система Windows 7 или 10 64-разрядная версия;
- видеокамера, разпознаваемая операционной системой.


## Установка программы

Для установки программы запустите программу-установщик и следуйте инструкциям.

## Запуск программы и возможные ошибки

Для запуска используйте ярлык, созданный установщиком. 
Также можно выполнить запуск исполняемого файла _spectr.exe_ через проводник/консоль.

Если после запуска окно программы не появляется (исчезает), то это говорит о возникновении ошибки и аварийном завершении программы. Возможные причины:

- отсутствие видеокамеры, указанной в файле конфигурации;
- неправильный формат файла конфигурации _spectr.yml_.

Чтобы получить информацию об ошибке, запустите программу из командной строки. Ошибка будет выведена в консоль.

## Настройка программы

После установки программа может потребоваться донастройка под конкретное аппаратного окружение. Настройка производится путем редактирования текстового файла конфигурации _spectr.yml_, который располагается в папке установки программы (по умолчанию – `C:\Program Files\Spectr\programs\`). Формат файла конфигурации YAML – будьте внимательны при редактировании, т.к. отступы имеют значение (строго 2 пробела).

Основные параметры конфигурационного файла приведены в таблице:

Параметр | Комментарий
--:|:--
source | Если к компьютеру подключено несколько видеокамер, то этот параметр задает номер видеокамеры. Значение 0 – видеокамера по умолчанию. Также, в целях тестирования, можно указать путь к файлу вида _img_NN.jpg_ – программа будет использовать последовательность файлов-изображений вместо видеокамеры.
capture-options: | Группа параметров, для конфигурации видеокамеры.  Успешность применения значений для этих параметров зависит от подключенной видеокамеры и режимов работы.
 FPS | Желаемая частота видеокадров от видеокамеры или при считывании последовательности изображений.
 FRAME_WIDTH | Желаемая ширина видеокадра.
 FRAME_HEIGHT |	Желаемая высота видеокадра.
spectr:| Группа параметров по работе со спектром.
CALIB_L1, CALIB_L2, CALIB_L3 | Длина волны первого, второго и третьего калибровочного лазера. Целое число в нм.
WIN_WIDTH, WIN_HEIGHT|Размер окна, на котором отображается спектр. Рекомендуется установить больше, чем размер видеокадра и меньше чем разрешение экрана компьютера.
control:| Настройки для регулировки видеокамеры. Разные видеокамеры имеют разный диапазон регулировок для параметров GAIN, и EXPOSURE.
GAIN_STEP_VAL | В драйвер передается значение: «положение ползунка × GAIN_STEP_VAL».
GAIN_STEPS | Количество положений ползунка настройки усиления GAIN.
EXPOSURE_LIMIT_LOW, EXPOSURE_LIMIT_HIGHT | Для настройки экспозиции ползунком в драйвер видеокамеры передаются значения от EXPOSURE_LIMIT_LOW до EXPOSURE_LIMIT_HIGHT
	

## Окна программы

Программа состоит из трех окон:
1. Консольное окно. В нем могут появляться текстовые сообщения об ошибках при работе программы, например, при установки параметров видеокамеры.
2. Основное окне программы. В нем отображается либо видео, по которому рассчитывается спектр, либо рассчитанный спектр. Для переключения режима отображения используйте клавишу пробел.
3. Инструментальное окно. Содержит кнопки и ползунки для управления настройками. Для отображения окна управления нажмите CTRL+P или кнопку    в верхней части основного окна.

## Настройка обработки спектра
1. Запускаем программу. Наблюдаем видео. В строке состояния контролируем разрешение видеокадра и частоту кадров. 
2. Выводим на экран инструментальное окно – (CTRL+P или кнпока   ). 
3. Сбрасываем окно, анализируемой области видеокадра, если оно было задано ранее - кнопка «Сбросить окно». 
4. Настраиваем изображение, регулировкой эксплозии и усиления. Поддержка функции регулировки зависит от видеокамеры. Ошибки регулировки будут отображаться в консольном окне.
5. Задаем окно анализа, по которому будет рассчитываться спектр, отсекая нерабочие (лишние) области. Для это используем кнопку «Задать окно»
6. Включаем отображение сетки (флажок «Сетка»). Выравниваем видеокадр с помощью ползунка «Поворот». Диапазон от 0 ( -10 градусов)  до 20  (+10 градусов). Значение 10 ползунка соответствует оригинальному изображению без цифрового поворота. 
Цифровой поворот изображения с большим разрешением является ресурсоемкой задачей и может привести к уменьшению FPS. При повороте контролируйте значение FPS в строке состояния. 
7. Переходим в режим отображения спектра (пробел или кнопка «Спектр»).
8. Выбираем количество видеокадров, по которым рассчитывается и обновляется график спектра (ползунок «Кадры накопления»). Также контролируем получаемый FPS в строке состояния. Чем больше количество кадров накопления, то больше значение arb.u и меньше частота обновления спектра.
9. Выполняем калибровку спектра. Для этого:

- сбрасываем предыдущую калибровку (кнопка «Сброс калибровки»);
- формируем изображение спектра для первого лазера;
- в инструментальном окне нажимаем кнопку калибровки по первому лазеру и указываем положение пика на графике спектра левой кнопкой мыши;
Аналогичном образом указывается вторая и третья точка. После установки второй точки происходит расчет шкалы X по линейной интерполяции. После указания третьей точки выполняется расчет шкалы X путем интерполяции полиномом второй степени.

Заданные настройки для отображения спектра автоматически сохраняются при завершении программы и применяются при запуске программы.

## Анализ спектра
Текущую (отображаемую) спектрограмму можно зафиксировать. По аналогии с калькулятором сохранить в ячейке памяти (кнопки MS - установить и МС – сбросить). После нажатия кнопки MS в основном окне будут отображаться две спектрограммы – текущая и зафиксированная.
Отображаемые спектрограммы можно экспортировать в файл cvs для дальнейшего анализа в программах Excel, Matlab и др. Для этого нажмите кнопку «Экспорт спектра…» и укажите имя и расположение файла.
